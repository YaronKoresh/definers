# ----------------------------------------------------------------------------------
# 1. BUILD SYSTEM: This section is updated to use Poetry's build backend.
# ----------------------------------------------------------------------------------
[build-system]
requires = ["poetry-core>=1.0.0"]
build-backend = "poetry.core.masonry.api"

# ----------------------------------------------------------------------------------
# 2. NVIDIA SOURCE: This is the key addition. It tells Poetry about NVIDIA's index.
# ----------------------------------------------------------------------------------
[[tool.poetry.source]]
name = "nvidia"
url = "https://pypi.nvidia.com"
priority = "supplemental"

# ----------------------------------------------------------------------------------
# 3. METADATA: All project info now lives under [tool.poetry].
# ----------------------------------------------------------------------------------
[tool.poetry]
name = "definers"
version = "0.1.0"
description = "A comprehensive Python toolkit for AI, data processing, media manipulation, and system utilities."
authors = ["Yaron Koresh <aharonkoresh1@gmail.com>"]
readme = "README.md"
license = "MIT"
classifiers = [
    "Programming Language :: Python :: 3",
    "License :: OSI Approved :: MIT License",
    "Operating System :: OS Independent",
]
homepage = "https://github.com/YaronKoresh/definers"
repository = "https://github.com/YaronKoresh/definers"

# ----------------------------------------------------------------------------------
# 4. DEPENDENCIES: Dependencies are now split into sections.
#    Note the new syntax for the python version.
# ----------------------------------------------------------------------------------
[tool.poetry.dependencies]
python = ">=3.8"
langdetect = "*"
cython = "*"
pandas = "*"
scipy = "*"
backoff = "*"
googledrivedownloader = "*"
requests = "*"
sentencepiece = "*"

# ----------------------------------------------------------------------------------
# 5. DEPENDENCY GROUPS: Optional dependencies are now "groups".
#    This makes them easy to manage and install.
# ----------------------------------------------------------------------------------
[tool.poetry.group.ai.dependencies]
# Core AI & ML Frameworks
torch = "~=2.3.1"
torchvision = "~=0.18.1"
torchaudio = "~=2.3.1"
tensorflow = "==2.18.0"
numba = "~=0.60.0"
numpy = "~=1.26.4"

# Hugging Face Ecosystem
transformers = "~=4.42.0"
diffusers = "~=0.29.0"
accelerate = "~=0.31.0"
datasets = "~=2.20.0"
peft = "~=0.11.1"
hf_transfer = "~=0.1.6"
bitsandbytes = "~=0.43.1"

# ONNX Runtime
onnx = "~=1.16.1"
onnxruntime = "~=1.18.1"
skl2onnx = "~=1.17.0"
joblib = "~=1.5.2"

# General ML & Utilities
scikit-learn = "~=1.5.1"
xgboost = "~=2.1.0"
tensorboardX = "~=2.6.3"
einops = "~=0.8.0"
av = "~=12.1.0"
torchsde = "~=0.2.6"
torchcrepe = "~=0.0.24"
torchfcpe = "~=0.0.3"
chatterbox-tts = "~=0.1.2"
compressed-tensors = "~=0.11.0"
# Note the new syntax for git dependencies
fairseq = {git = "https://github.com/YaronKoresh/fairseq.git"}

[tool.poetry.group.audio.dependencies]
librosa = "~=0.10.2"
demucs = "~=4.0.1"
pydub = "~=0.25.1"
soundfile = "~=0.12.1"
resampy = "~=0.4.3"
audioread = "~=3.0.1"
pyworld = "~=0.3.4"
praat-parselmouth = "~=0.4.3"
basic-pitch = "~=0.4.0"
mido = "~=1.3.2"
midi2audio = "~=0.1.0"
matplotlib = "~=3.9.1"
matchering = "~=2.0.6"
sox = "~=1.5.0"
sounddevice = "~=0.5.0"
mir_eval = "~=0.7"
ffmpeg-python = "~=0.2.0"
madmom = {git = "https://github.com/CPJKU/madmom", rev = "0551aa8f48d71a367d92b5d3a347a0cf7cd97cc9"}

[tool.poetry.group.visual.dependencies]
pillow = "~=10.4.0"
pillow_heif = "~=0.16.0"
scikit-image = "~=0.24.0"
opencv-contrib-python-headless = "~=4.10.0.84"
moviepy = "~=1.0.3"
imageio = "~=2.34.2"
refiners = {git = "https://github.com/finegrain-ai/refiners", rev = "d288e94fa8eed1386bd28cd0d5ceb8109c3ff398"}

[tool.poetry.group.web.dependencies]
requests-html = "~=0.10.0"
beautifulsoup4 = "~=4.12.3"
lxml = {version = "~=5.2.2", extras = ["html_clean"]}
cssselect = "~=1.2.0"
playwright = "~=1.45.0"

[tool.poetry.group.ui.dependencies]
gradio = "~=4.37.2"
gradio-client = "~=1.1.0"
spaces = "~=0.39.0"

# ----------------------------------------------------------------------------------
# 6. GPU GROUP: We now tell Poetry to get these specific packages from the "nvidia" source.
#    This automatically resolves the installation issue.
# ----------------------------------------------------------------------------------
[tool.poetry.group.gpu.dependencies]
cupy-cuda12x = {version = "~=13.3.0", source = "nvidia"}
cuml-cu12 = {version = "~=24.08.0", source = "nvidia"}
cudf-cu12 = {version = "~=24.08.0", source = "nvidia"}

# ----------------------------------------------------------------------------------
# 7. EXTRAS: The "all" group is now defined cleanly here.
# ----------------------------------------------------------------------------------
[tool.poetry.extras]
all = ["ai", "audio", "visual", "web", "ui", "gpu"]